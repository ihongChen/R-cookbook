library(httr)
url <- 'https://survey.banking.gov.tw/statis/stmain.jsp?sys=220&ym=10403&ymt=10503&kind=21&type=1&funid=i07&cycle=41&outmode=0&compmode=00&outkind=1&fldspc=0,5,&codspc0=4,2,&rdm=aWbbceaN'
res<- GET(url)
content(res)
res$content
data <- readHTMLTable(rawToChar(res$content),
stringsAsFactors = FALSE)
rawToChar(res$content)
res<-GET(url2)
url2 <-'https://survey.banking.gov.tw/statis/stmain.jsp?sys=120&ym=10503&ymt=10503&kind=0&type=2&funid=2050&cycle=0&outmode=3&rdm=me9nlfqA'
res<-GET(url2)
content(res)
content(res,'text')
url <- 'https://survey.banking.gov.tw/statis/stmain.jsp?sys=220&ym=10403&ymt=10503&kind=21&type=1&funid=i07&cycle=41&outmode=0&compmode=00&outkind=1&fldspc=0,5,&codspc0=4,2,&rdm=aWbbceaN'
res<- GET(url)
content(res,'text')
rawToChar(res$content)
res_content <- rawToChar(res$content)
class(res_content)
library(xml2)
read_html(res_content)
read_html(res_content)
html_content<-read_html(res_content)
html_content$node
html_content
html_content$doc
names(html_content$doc)
html_content
html_content$html
names(html_content)
sep=",")
temp <- read.csv('d:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv',header=TRUE)
temp <- read_csv('d:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv',header=TRUE)
library(dplyr)
temp <- read_csv('d:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv',header=TRUE)
fill = TRUE)
header = TRUE, sep = ",", quote = "\"")
read.csv('d:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv',header = TRUE, sep = ",", quote = "\"")
temp <- read_csv('d:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv',header=TRUE)
temp <- read.csv('d:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv',header=TRUE)
temp <- read.csv('d:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv',header=FALSE)
readBin(filepath,what="raw",n=3)
readBin(file(filepath),what="raw",n=3)
filepath = 'd:/ihong/work/公司狀態清冊/公司清冊/設立/201601.csv'
readBin(file(filepath),what="raw",n=3)
readBin(filepath,what="raw",n=3)
readLines(file(filepath),encoding='utf8',n=1)
readLines(file(filepath),encoding='big5',n=1)
readLines(file(filepath),encoding='big5',n=1)
readBin(filepath,what="raw",n=3)
filepath = 'd:/ihong/work/公司狀態清冊/公司清冊/設立/201602.csv'
readBin(filepath,what="raw",n=3)
readLines(file(filepath),encoding='utf-8',n=1)
readLines(file(filepath,encoding='utf-8'),n=1)
read.table(filepath,fileEncoding = 'utf-8')
read.table(file(filepath,encoding = 'utf-8'),header=TRUE,sep=",")
read.table(file(filepath,encoding = 'utf-8'),sep=",")
read.csv(file(filepath,encoding = 'utf-8'),sep=",")
110_info
110n_info()
l10n_info()
read.table(textConnection(file(filepath),encoding="UTF-8"),header=TRUE,sep=",")
library(stringi)
file_info <- file.info(filepath)
file_info
file_info$size
setupComp_bin <- readBin(filepath,what="raw",n=file_info$size)
setupComp_bin
data_big5 <- stri_encode(setupComp_bin,"utf8","big5")
warnings()
data_big5
read.csv(data_big5,fileEncoding = 'big5')
read.csv(data_big5,encoding= 'big5')
read.csv(data_big5)
class(data_big5)
read.table(textConnection(data_big5,encoding="big5"),header=TRUE,sep=",")
read.table(textConnection(data_big5),header=TRUE,sep=",")
readBin(filepath,what="raw",n=3) ##
readLines(file(filepath,encoding='utf-8'),n=1)
read.table(file(filepath,encoding = 'utf-8'),sep=",")
class(data_big5)
data_big5 <- stri_encode(setupComp_bin,"utf8","big5")
read.table(textConnection(data_big5),header=TRUE,sep=",")
data_csv <-read.csv(textConnection(data_big5),header=TRUE,sep=",")
data_table<-read.table(textConnection(data_big5),header=TRUE,sep=",")
View(data_csv)
View(data_table)
l10n_info()
l10n_info()$UTF-8
l10n_info()$`UTF-8`
l10n_info()$`MBCS`
l10n_info()
textConnection(data_big5)
View(data_csv)
View(ComApplyList)
ComApplyList<-read.table(textConnection(data_big5),header=TRUE,sep=",")
View(ComApplyList)
readLines(file(filepath,encoding='utf-8'),n=1)
class(ComApplyList)
select(ComApplyList,統一編號)
select(ComApplyList,統一編號,公司名稱)
select(ComApplyList,統一編號)
class(select(ComApplyList,統一編號))
for (i in select(ComApplyList,統一編號)) print(i)
data.frame(lapply(ComApplyList, as.character), stringsAsFactors=FALSE)
data.frame(lapply(select(ComApplyList,統一編號), as.character), stringsAsFactors=FALSE)
class(data.frame(lapply(select(ComApplyList,統一編號), as.character), stringsAsFactors=FALSE))
url <- "http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO%20eq%" +'88'
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO%20eq%",'88')
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20eq",'88')
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO\%20eq\%",'88')
url
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20eq",'88')
url
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20 eq %s",'88')
url
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20 eq %s",account_no)
account_no <- '86517384'
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20 eq %s",account_no)
GET(url)
library(httr)
GET(url)
test<- GET(url)
test$content
url
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20%eq%%s",account_no)
test<- GET(url)
test$status_code
url <- sprintf("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20\%eq\%%s",account_no)
paste0(url,"%")
url <- paste0("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO20%eq%",account_no)
url
test<- GET(url)
test$status_code
test$content
test$handle
test
test$cookies
test$content
stri_encode(test$content,'utf8','big5')
class(test$content)
stri_encode(test$content,"utf8","big5")
test<- GET(url)
test$content
stri_encode(test$content,"utf8","big5")
url <- 'http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO 20eq 2086517384'
test<- GET(url)
test$content
url <- 'http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO%20eq%2086517384'
test<- GET(url)
stri_encode(test$content,"utf8","big5")
url2 <- paste0("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO%20eq%",account_no)
test<- GET(url2)
stri_encode(test$content,"utf8","big5")
test$content
url2
url
url2
url
url2 <- paste0("http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO%20eq%20",account_no)
url2==url
test<- GET(url2)
stri_encode(test$content,"utf8","big5")
library(jsonlite)
toJSON(stri_encode(test$content,"utf8","big5"),pretty=TRUE) #
fromJSON()
fromJSON(josn_content)
json_content<-stri_encode(test$content,"utf8","big5")
fromJSON(json_content)
fromJSON()}
json_content<-{
stri_encode(test$content,"utf8","big5") %>%
fromJSON()
}
json_content
toJSON(json_content,pretty=TRUE)
View(json_content)
a = 1 %>% print()
a<-1 %>% print()
gcis_api<-function(account_no) {
url_api<-paste0(part_api,account_no)
res<-GET(url_api)
result <- res$content %>%
stri_encode("utf8","big5") %>%
fromJSON
return(result)
}
gcis_api(account_no)
part_api <- "http://data.gcis.nat.gov.tw/od/data/api/5F64D864-61CB-4D0D-8AD9-492047CC1EA6?$format=json&$filter=Business_Accounting_NO%20eq%20"
gcis_api(account_no)
business_no <- '86517384' # 統編
class(json_content)
toJSON(class(json_content))
toJSON(json_content)
class(toJSON(json_content))
sino_bank <- '86517384' # 統編
gcis_api<-function(accountingNo) {
url_api<-paste0(part_api,accountingNo)
res<-GET(url_api)
result <- res$content %>%
stri_encode("utf8","big5") %>%
toJSON
return(result)
}
gcis_api(sino_bank)
## 查詢
gcis_api<-function(accountingNo) {
url_api<-paste0(part_api,accountingNo)
res<-GET(url_api)
result <- res$content %>%
stri_encode("utf8","big5") %>%
fromJSON
return(result)
}
gcis_api(sino_bank)
comApplyList
ComApplyList
company_id <- ComApplyList$統一編號
company_id
sapply(company_id,print)
company_id[1:10]
company_data <- sapply(company_id[1:5],gcis_api())
gcis_api<-function(accountingNo) {
url_api<-paste0(part_api,accountingNo)
res<-GET(url_api)
result <- res$content %>%
stri_encode("utf8","big5") %>%
fromJSON
return(result)
}
company_data <- sapply(company_id[1:5],gcis_api())
company_data <- sapply(company_id[1:5],gcis_api)
company_data
class(company_data)
company_data[,1]
View(company_data)
class(ComApplyList$統一編號)
class(ComApplyList$資本額)
ComApplyList$資本額
ComApplyList$資本額[[1]]
ComApplyList$資本額[[3]]
ComApplyList$資本額[[4]]
gcis_api('22099131')
gcis_api('16159363')
company_data <- sapply(company_id,gcis_api)
View(company_data)
company_data <- sapply(company_id,gcis_api)
Q
company_data <- sapply(company_id[6:20],gcis_api)
View(company_data)
company_data <- sapply(company_id[19:20],gcis_api)
View(company_data)
company_data <- sapply(company_id[16:20],gcis_api)
View(company_data)
company_data <- sapply(company_id[11:15],gcis_api)
View(company_data)
View(company_data)
length(company_id)
company_data <- sapply(company_id[1:1000],gcis_api)
size(company_data)
View(company_data)
class(company_data)
company_data$size
company_data <- sapply(company_id[1:100],gcis_api)
View(company_data)
grep('[0-9]{6}',filepath)
grep('[0-9]{1-6}',filepath)
grep('[/d]',filepath)
grep('2',filepath)
grep('xxx',filepath)
grep('xx',filepath)
grep('d',filepath)
grep('\\d',filepath)
files <- list.files("d:/ihong/work/公司狀態清冊/公司清冊/設立/")
files
class(files)
gsub(files,'.csv','')
gsub('.csv','')
gsub('.csv','',files)
files
filesPATH <- paste0(fileDIR,files)
sapply(fileDir,paste0)
files
paste0(fileDir,files[1])
paste0(fileDir,files[[1]])
fileDir
fileDir <- "d:/ihong/work/公司狀態清冊/公司清冊/設立/"
paste0(fileDir,files[[1]])
paste0(fileDir,files[1])
sapply(files,function(x) paste0(fileDir,files[x]))
sapply(files,function(x) paste0(fileDir,files[x]))[[1]]
files
paste0(fileDir,files[1])
sapply(files,function(x) paste0(fileDir,files[[x]]))
sapply(files,function(x) paste0(fileDir,files[[x]]))
sapply(files,function(x) paste0(fileDir,files[x]))
sapply(files,function(x) paste0(fileDir,files[x]))[1]
files
filedirs<-
for (i in 1:length(files)){
paste0(fileDir,files[i])
}
filedirs
for (i in 1:length(files)){
print(paste0(fileDir,files[i]))
}
sapply(1:length(files),function(x) paste0(fileDir,files[x]))[1]
files
length(files)
1:length(files)
sapply(c(1:length(files)),function(x) paste0(fileDir,files[x]))[1]
sapply(c(1:length(files)),function(x) paste0(fileDir,files[x]))
sapply(files,function(x) paste0(fileDir,files[x]))
sapply(1:length(files),function(x) paste0(fileDir,files[x]))
filepath <- filepaths[1]
filepaths <- sapply(1:length(files),function(x) paste0(fileDir,files[x]))
filepath <- filepaths[1]
file_info <- file.info(filepath)
setupComp_bin <- readBin(filepath,what="raw",n=file_info$size)
data_big5 <- stri_encode(setupComp_bin,"utf8","big5")
df<-read.table(textConnection(data_big5),header=TRUE,sep=",")
View(df)
View(df)
select(df$公司名稱)
df$公司名稱[[3]]
readBin(filepath,what="raw",n=3) ##ef bb bf
readLines(file(filepath,encoding='utf-8'),n=1)
readLines(file(filepath,encoding='utf-8'),n=2)
readLines(file(filepath,encoding='utf-8'),n=10)
read.table(file(filepath,encoding = 'utf-8'),sep=",") # failed !!
Sys.setlocale(category="LC_ALL", locale = "English_United States.1252")
Sys.getlocale(category="LC_ALL")
read.table(filepath,sep=',',encoding='chinese', stringsAsFactors=FALSE)
filepath
read.csv(filepath)
read.table(filepath,sep=',',encoding='chinese', stringsAsFactors=FALSE)
read.table(file(filepath),sep=',',encoding='chinese', stringsAsFactors=FALSE)
read.table(file(filepath,encoding='utf8'),sep=',',encoding='chinese', stringsAsFactors=FALSE)
read.table(filepath,sep=',',encoding='utf8', stringsAsFactors=FALSE)
file_info <- file.info(filepath)
setupComp_bin <- readBin(filepath,what="raw",n=file_info$size)
# 利用stringi套件轉換成big5
data_big5 <- stri_encode(setupComp_bin,"utf8","big5")
# 讀入dataframe
df<-read.table(textConnection(data_big5),header=TRUE,sep=",")
readBin(filepath,what='raw',n=3)
filepath = 'd:/ihong/work/公司狀態清冊/公司清冊/設立/201602.csv'
readBin(filepath,what='raw',n=3)
read.table(filepath,sep=',',encoding='utf8', stringsAsFactors=FALSE)
read.table(filepath,sep=',',encoding='chinese', stringsAsFactors=FALSE)
library(dplyr)
library(stringi)
######################## 讀入公司設立清冊資料 ###############################
filepath = 'd:/ihong/work/公司狀態清冊/公司清冊/設立/201602.csv'
readBin(filepath,what="raw",n=3) ##ef bb bf
readLines(file(filepath,encoding='utf-8'),n=1)
read.table(file(filepath,encoding = 'utf-8'),sep=",") # failed !!
setupComp_bin <- readBin(filepath,what="raw",n=file_info$size)
file_info <- file.info(filepath)
setupComp_bin <- readBin(filepath,what="raw",n=file_info$size)
data_big5 <- stri_encode(setupComp_bin,"utf8","big5")
data_big5
warnings()
stri_encode(setupComp_bin,to = 'big5')
data_big5_test<- stri_encode(file(filepath,encoding='utf8'),'utf8','big5')
data_big5_test
data_big5_test<- stri_encode(readLines(filepath,encoding='utf8'),'utf8','big5')
readLines(filepath,encoding='utf8')
data_big5_test
data_big5_test<- stri_encode(readLines(filepath,encoding='utf8'),'utf8','big5')
warnings
devtools::install_github("rstudio/tensorflow")
devtools::install_github("rstudio/tensorflow")
exit
exit()
library(mxnet)
install.packages("drat", repos="https://cran.rstudio.com")
drat:::addRepo("dmlc")
install.packages("mxnet")
require(mxnet)
require(mxnet)
require(mlbench)
require(mxnet)
exit
q()
q()
download.file("https://github.com/ywchiu/rcookbook/raw/master/
chapter3/employees.csv", "employees.csv")
employees <- read.csv('employees.csv', head=FALSE)
salaries <- read.csv('salaries.csv', head=FALSE)
getwd)
setwd('d:/ihong/resource/data_book/R/R_Cookbook_EX/ch03_preprocess/')
download.file("https://github.com/ywchiu/rcookbook/raw/master/
chapter3/employees.csv", "employees.csv")
employees <- read.csv('employees.csv', head=FALSE)
salaries <- read.csv('salaries.csv', head=FALSE)
names(salaries)
names(employees) <- c("emp_no", "birth_date", "first_name",
"last_name", "gender", "hire_date")
names(salaries) <- c("emp_no", "salary", "from_date","to_date")
View(employees)
colnames(salaries)
colnames(employees)
rownames(salaries)
salaries$emp_no
salaries
salaries$emp_no
rownames(salaries) <-salaries$emp_no
salaries
head(salaries)
tail(salaries)
rownames(salaries)
salaries$emp_no
?rownames
m0<-matrix(NA,4,0)
m0
rownames(m0)
m2 <- cbind(1,1:4)
colnames(m2)
colnames(m2,do.NULL = FALSE)
employees
c(1:10)
dimnames(employees) <- list(c(1:10),
c("emp_no","birth_date","first_name","last_name","gender","hire_data"))
employees
class(employees)
str(employees)
class(employees$emp_no)
class(employees$birth_date)
colnames(employees)
str(employees)
employees$birth_date <- as.Date(employees$birth_date)
class(employees$birth_date)
str(employees)
employees$hire_data <- as.Date(employees$hire_data)
employees$first_name <- as.character(employees$first_name)
employees$last_name <- as.character(employees$last_name)
str(employees)
salaries$from_date <- as.Date(salaries$from_date)
salaries$to_date <- as.Date(salaries$to_date)
employees <- read.csv('./employees.csv',colClasses = c(NA,"Date","character",
"character","factor","Date"))
str(employees)
employees <- read.csv('./employees.csv',colClasses = c(NA,"Date","character",
"character","factor","Date"))
str(employees)
employees
str(employees)
employees <- read.csv('./employees.csv',colClasses = c(NA,"Date","character",
"character","factor","Date"),header = FALSE)
str(employees)
colnames(salaries)
employees
names(employees) <- c("emp_no", "birth_date", "first_name",
"last_name", "gender", "hire_date")
names(salaries) <- c("emp_no", "salary", "from_date","to_date")
str(employees)
employees$hire_date
employees$hire_date + 30
employees$hire_date - employees$birth_date
difftime(employees$hire_date,employees$birth_date,units = "weeks")
install.packages("lubridate")
library(lubridate)
ymd(employees$hire_date)
class(ymd(employees$hire_date))
ymd(employees$hire_date)
class(employees$hire_date)
now()
span <-interval(employees$birth_date,employees$hire_date)
span
span <-interval(ymd(employees$birth_date),ymd(employees$hire_date))
span
time_period <- as.period(span)
time_period
span2 <- interval(now(),ymd(employees$birth_date))
sapn2
span2
years <- as.period(span2)
years
?ymd
employees$hire_date
ymd(employees$hire_date)
